# =====================================
# ðŸ“ˆ DYNAMIC CHART UPDATE (Telemetry Simulator)
# =====================================

# âœ… Safe initialization of all session_state variables
for key in [
    "sim_chart_xgb",
    "sim_chart_lstm",
    "sim_chart_xgb_data",
    "sim_chart_lstm_data"
]:
    if key not in st.session_state:
        if "data" in key:
            st.session_state[key] = []
        else:
            st.session_state[key] = st.line_chart(
                pd.DataFrame(columns=[key.replace("sim_chart_", "").replace("_", " ").upper()])
            )

# Append new data safely
st.session_state.sim_chart_xgb_data.append(xgb_prob)
st.session_state.sim_chart_lstm_data.append(lstm_prob)

# Keep the last 50 samples only (smooth scroll)
st.session_state.sim_chart_xgb_data = st.session_state.sim_chart_xgb_data[-50:]
st.session_state.sim_chart_lstm_data = st.session_state.sim_chart_lstm_data[-50:]

# Convert to DataFrames
df_xgb = pd.DataFrame(st.session_state.sim_chart_xgb_data, columns=["XGBoost Failure Probability"])
df_lstm = pd.DataFrame(st.session_state.sim_chart_lstm_data, columns=["LSTM Failure Probability"])

# Display charts side by side for better visual alignment
col_xgb, col_lstm = st.columns(2)
with col_xgb:
    st.session_state.sim_chart_xgb.line_chart(df_xgb)
with col_lstm:
    st.session_state.sim_chart_lstm.line_chart(df_lstm)